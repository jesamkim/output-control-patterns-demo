# LLM Output Control Design Patterns Demo

LLM ì¶œë ¥ ì œì–´ ë””ìì¸ íŒ¨í„´ì„ **Amazon Bedrock Claude Sonnet 4.5 (Global Inference)**ë¡œ êµ¬í˜„í•œ ë°ëª¨ì…ë‹ˆë‹¤.

> ğŸ“– Reference: [Generative AI Design Patterns](https://www.oreilly.com/library/view/generative-ai-design/9798341622654/) â€” Lakshmanan & Hapke, O'Reilly 2025

![Architecture](images/architecture.png)

## Patterns

### 1. Style Transfer â€” í†¤Â·ë¬¸ì²´ ë³€í™˜

ê°™ì€ ì…ë ¥ì— System Promptë§Œ ë°”ê¿”ì„œ ë‹¤ë¥¸ í†¤ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤. ì½˜í…ì¸ (ì˜ë¯¸)ëŠ” ë³´ì¡´í•˜ê³  ìŠ¤íƒ€ì¼ë§Œ ë³€ê²½í•©ë‹ˆë‹¤.

```
python3 demo.py 1
```

**ì‹¤í–‰ ê²°ê³¼:**

> **ì›ë¬¸:** ì„œë²„ê°€ ë˜ í„°ì¡Œì–´ìš”. ë¹¨ë¦¬ í™•ì¸í•´ì£¼ì„¸ìš”. ì–´ì œë„ ê°™ì€ ë¬¸ì œì˜€ëŠ”ë° ì•„ì§ë„ ì•ˆ ê³ ì³ì§„ ê±°ì˜ˆìš”?

| Style | Output |
|-------|--------|
| ë¹„ì¦ˆë‹ˆìŠ¤ ê²©ì‹ì²´ | ì„œë²„ì— ì¥ì• ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤. ì¡°ì†í•œ í™•ì¸ì„ ìš”ì²­ë“œë¦½ë‹ˆë‹¤. ì „ì¼ì—ë„ ë™ì¼í•œ ë¬¸ì œê°€ ë°œìƒí•œ ë°” ìˆìœ¼ë‚˜, ì•„ì§ í•´ê²°ë˜ì§€ ì•Šì€ ìƒí™©ì…ë‹ˆê¹Œ? |
| ê¸°ìˆ  ë³´ê³ ì„œ | **ì¸ì‹œë˜íŠ¸ ë³´ê³ ì„œ** â€” ì„œë²„ ì¥ì•  ì¬ë°œ, ì „ì¼ ë™ì¼ ì¦ìƒì˜ í•´ê²° ì¡°ì¹˜ ë¶ˆì™„ì „ ì¶”ì •, ê·¼ë³¸ ì›ì¸ ë¶„ì„ ë° í•´ê²° ì¡°ì¹˜ í•„ìš” |
| ì¹œì ˆí•œ ê³ ê° ì‘ëŒ€ | ê³ ê°ë‹˜ê»˜ì„œ ê²ªê³  ê³„ì‹  ë¶ˆí¸í•¨ì„ ì§„ì‹¬ìœ¼ë¡œ ê³µê°í•˜ë©°, ë¹ ë¥¸ í•´ê²°ì„ ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê³  ìˆìŠµë‹ˆë‹¤. í˜„ì¬ ê¸°ìˆ íŒ€ì—ì„œ ê¸´ê¸‰í•˜ê²Œ ì›ì¸ì„ íŒŒì•…í•˜ê³  ìˆìŠµë‹ˆë‹¤. |

### 2. Reverse Neutralization â€” ë„ë©”ì¸ ì „ë¬¸ê°€ í˜ë¥´ì†Œë‚˜

RLHF ì •ë ¬ë¡œ ì¸í•´ ì¤‘ë¦½ì ì¸ ë‹µë³€ë§Œ í•˜ëŠ” LLMì„, ë„ë©”ì¸ ì „ë¬¸ê°€ì˜ ê´€ì ìœ¼ë¡œ ì „í™˜í•©ë‹ˆë‹¤.

```
python3 demo.py 2
```

**ì‹¤í–‰ ê²°ê³¼:**

> **ì§ˆë¬¸:** í´ë¼ìš°ë“œ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ê³ ë ¤í•˜ê³  ìˆëŠ”ë°, ì–´ë–¤ ì „ëµì´ ì¢‹ì„ê¹Œìš”?

| Persona | íŠ¹ì§• |
|---------|------|
| ğŸ¤– ì¤‘ë¦½ AI | 6R ì „ëµì„ êµê³¼ì„œì ìœ¼ë¡œ ë‚˜ì—´. "ê²½ìš°ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤" ì‹ì˜ íšŒí”¼ |
| ğŸ—ï¸ AWS SA (10ë…„ ê²½ë ¥) | "ë¹…ë±… ë§ˆì´ê·¸ë ˆì´ì…˜ì€ ì ˆëŒ€ í•˜ì§€ ë§ˆì„¸ìš”" â€” ì‹¤íŒ¨ ì‚¬ë¡€ í¬í•¨, êµ¬ì²´ì  ì„œë¹„ìŠ¤ëª…(MGN, S3+CloudFront), Quick Win â†’ 6R â†’ ìµœì í™” 3ë‹¨ê³„ |
| ğŸš€ ìŠ¤íƒ€íŠ¸ì—… CTO | "ì§€ê¸ˆ ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ì •ë§ í•„ìš”í•œê°€ìš”?" â€” ë¹„ìš©/ì¸ë ¥ í˜„ì‹¤ ë¶„ì„, Strangler Fig Pattern ì¶”ì²œ, 15ëª… íŒ€ì— ë©€í‹°í´ë¼ìš°ë“œëŠ” ì§€ì˜¥ |

### 3. Content Optimization â€” Self-Refine ë£¨í”„

ìƒì„± â†’ ìê¸° í‰ê°€ â†’ í”¼ë“œë°± ë°˜ì˜ ì¬ìƒì„±ì˜ ë°˜ë³µ ë£¨í”„ë¡œ í’ˆì§ˆì„ ì²´ê³„ì ìœ¼ë¡œ ê°œì„ í•©ë‹ˆë‹¤.

![Self-Refine Loop](images/self-refine-loop.png)

```
python3 demo.py 3
```

**ì‹¤í–‰ ê²°ê³¼:**

> **íƒœìŠ¤í¬:** Amazon Bedrockì˜ ì£¼ìš” íŠ¹ì§•ì„ 3ë¬¸ì¥ìœ¼ë¡œ ì„¤ëª…í•˜ì„¸ìš”. ëŒ€ìƒ: í´ë¼ìš°ë“œ ê²½í—˜ì´ ì—†ëŠ” ê²½ì˜ì§„.

**ğŸ“ 1ì°¨ ìƒì„± (temp=0.8):**
> Amazon Bedrockì€ AI ì±—ë´‡ì´ë‚˜ ìë™í™” ì„œë¹„ìŠ¤ë¥¼ ì‰½ê²Œ ë§Œë“¤ ìˆ˜ ìˆëŠ” í´ë¼ìš°ë“œ ê¸°ë°˜ í”Œë«í¼ì…ë‹ˆë‹¤. ë³µì¡í•œ ê¸°ìˆ  ì§€ì‹ ì—†ì´ë„ **Claude, Llama** ê°™ì€ ì„¸ê³„ ìµœê³  ìˆ˜ì¤€ì˜ AI ëª¨ë¸ë“¤ì„ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, íšŒì‚¬ì˜ ë°ì´í„° ë³´ì•ˆì„ **ì™„ë²½í•˜ê²Œ** ì§€í‚¤ë©´ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ì— ë§ê²Œ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ğŸ” ìê¸° í‰ê°€ (temp=0.3):**

| ê¸°ì¤€ | ì ìˆ˜ | í”¼ë“œë°± |
|------|------|--------|
| ëª…í™•ì„± | 4/5 | "Claude, Llama"ëŠ” ê²½ì˜ì§„ì—ê²Œ ìƒì†Œ â†’ "ì„¸ê³„ ìµœê³  ìˆ˜ì¤€ì˜ AI ëª¨ë¸"ë¡œ ì¶”ìƒí™” |
| ê°„ê²°ì„± | 3/5 | ë‘ ë²ˆì§¸ ë¬¸ì¥ ê³¼ë„í•˜ê²Œ ê¸¸ì–´ í˜¸í¡ì´ ê¹€ (54ë‹¨ì–´) â†’ ë¶„ë¦¬ í•„ìš” |
| ì„¤ë“ë ¥ | 5/5 | Time-to-market, TCO, ì»´í”Œë¼ì´ì–¸ìŠ¤ ì •í™•íˆ íƒ€ê²ŸíŒ… |
| ì •í™•ì„± | 4/5 | "ì™„ë²½í•˜ê²Œ"ëŠ” ê³¼ì¥ â†’ "ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ë³´ì•ˆìœ¼ë¡œ" ìˆ˜ì • |

**âœ… ê°œì„ ëœ ìµœì¢… ë²„ì „ (temp=0.5):**
> Amazon Bedrockì€ AI ì±—ë´‡ì´ë‚˜ ìë™í™” ì„œë¹„ìŠ¤ë¥¼ ì‰½ê²Œ ë§Œë“¤ ìˆ˜ ìˆëŠ” í´ë¼ìš°ë“œ ê¸°ë°˜ í”Œë«í¼ì…ë‹ˆë‹¤. ë³µì¡í•œ ê¸°ìˆ  ì§€ì‹ ì—†ì´ë„ ì„¸ê³„ ìµœê³  ìˆ˜ì¤€ì˜ AI ëª¨ë¸ë“¤ì„ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, **ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ë³´ì•ˆ**ìœ¼ë¡œ íšŒì‚¬ ë°ì´í„°ë¥¼ ë³´í˜¸í•©ë‹ˆë‹¤. ì‚¬ìš©í•œ ë§Œí¼ë§Œ ë¹„ìš©ì„ ì§€ë¶ˆí•˜ëŠ” êµ¬ì¡°ë¡œ, ëŒ€ê·œëª¨ ì´ˆê¸° íˆ¬ì ì—†ì´ ê³ ê° ì„œë¹„ìŠ¤ ê°œì„ , ì—…ë¬´ ìë™í™”, ë°ì´í„° ë¶„ì„ ë“±ì„ ì¦‰ì‹œ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

â†’ ì „ë¬¸ ìš©ì–´ ì œê±°, ë¬¸ì¥ ê¸¸ì´ ë‹¨ì¶•, ê³¼ì¥ í‘œí˜„ ìˆ˜ì • â€” Self-Refineìœ¼ë¡œ **4.0 â†’ 4.5+** í’ˆì§ˆ í–¥ìƒ

## Quick Start

### Prerequisites

- Python 3.9+
- AWS credentials configured (`~/.aws/credentials`)
- Bedrock Claude Sonnet 4.5 access enabled

### Install & Run

```bash
pip install boto3
python3 demo.py all    # ì „ì²´ ë°ëª¨
python3 demo.py 1      # Style Transferë§Œ
python3 demo.py 2      # Reverse Neutralizationë§Œ
python3 demo.py 3      # Content Optimizationë§Œ
```

## Model

| | |
|---|---|
| **Model** | Claude Sonnet 4.5 |
| **Model ID** | `global.anthropic.claude-sonnet-4-5-20250929-v1:0` |
| **API** | Amazon Bedrock Converse API |
| **Region** | us-west-2 (Global Inference) |

## Project Structure

```
output-control-patterns-demo/
â”œâ”€â”€ demo.py              # ë©”ì¸ ë°ëª¨ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ README.md
â””â”€â”€ images/
    â”œâ”€â”€ architecture.png       # ì „ì²´ ì•„í‚¤í…ì²˜
    â””â”€â”€ self-refine-loop.png   # Self-Refine ë£¨í”„ ë‹¤ì´ì–´ê·¸ë¨
```

## References

1. Lakshmanan, V. & Hapke, H. (2025). *Generative AI Design Patterns.* O'Reilly Media.
2. Madaan, A., et al. (2023). *Self-Refine: Iterative Refinement with Self-Feedback.* [arXiv:2303.17651](https://arxiv.org/abs/2303.17651)
3. Ouyang, L., et al. (2022). *Training language models to follow instructions with human feedback.* [arXiv:2203.02155](https://arxiv.org/abs/2203.02155)
4. Reif, E., et al. (2022). *A Recipe for Arbitrary Text Style Transfer with Large Language Models.* ACL 2022.
